<app-layout>
  <div class="inversiones-container">
    <div class="panel-header">
      <div>
        <p class="eyebrow">Panel en vivo · Bitget</p>
        <h1>Inversiones</h1>
        <p class="subtitle">Tokens del panel actualizados en tiempo real vía WebSocket</p>
      </div>
      <div class="status-group">
        <mat-chip-set>
          <mat-chip [color]="connectionStatus === 'connected' ? 'primary' : 'warn'" selected>
            <mat-icon>{{ connectionStatus === 'connected' ? 'cloud_done' : (connectionStatus === 'connecting' ? 'sync' : 'cloud_off') }}</mat-icon>
            <span class="chip-text">
              {{ connectionStatus === 'connected' ? 'Conectado' : connectionStatus === 'connecting' ? 'Conectando' : 'Desconectado' }}
            </span>
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>

    <mat-card class="glass-card">
      <mat-card-content>
        <table mat-table [dataSource]="rows" class="tickers-table" matSort>
          <!-- Pair -->
          <ng-container matColumnDef="pair">
            <th mat-header-cell *matHeaderCellDef>Par</th>
            <td mat-cell *matCellDef="let row">
              <div class="pair">
                <div class="pair-symbol">{{ row.display }}</div>
                <div class="pair-id">{{ row.instId }}</div>
              </div>
            </td>
          </ng-container>

          <!-- Last -->
          <ng-container matColumnDef="last">
            <th mat-header-cell *matHeaderCellDef>Último</th>
            <td mat-cell *matCellDef="let row" class="mono">
              {{ formatNumber(row.last, 4) }}
            </td>
          </ng-container>

          <!-- Change -->
          <ng-container matColumnDef="changePct">
            <th mat-header-cell *matHeaderCellDef>24h %</th>
            <td mat-cell *matCellDef="let row">
              <span class="pill" [ngClass]="row.changePct && row.changePct >= 0 ? 'pill-up' : 'pill-down'">
                <mat-icon>
                  {{ row.changePct && row.changePct >= 0 ? 'trending_up' : 'trending_down' }}
                </mat-icon>
                {{ row.changePct !== undefined ? (row.changePct | number:'1.2-2') + '%' : '-' }}
              </span>
            </td>
          </ng-container>

          <!-- Bid/Ask -->
          <ng-container matColumnDef="bidAsk">
            <th mat-header-cell *matHeaderCellDef>Bid / Ask</th>
            <td mat-cell *matCellDef="let row" class="mono">
              <div class="stack">
                <span>Bid: {{ formatNumber(row.bid, 4) }}</span>
                <span>Ask: {{ formatNumber(row.ask, 4) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Range -->
          <ng-container matColumnDef="range">
            <th mat-header-cell *matHeaderCellDef>24h Rango</th>
            <td mat-cell *matCellDef="let row" class="mono">
              <div class="stack">
                <span>High: {{ formatNumber(row.high24h, 4) }}</span>
                <span>Low: {{ formatNumber(row.low24h, 4) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Time -->
          <ng-container matColumnDef="time">
            <th mat-header-cell *matHeaderCellDef>Actualizado</th>
            <td mat-cell *matCellDef="let row">
              {{ formatTime(row.ts) }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</app-layout>
