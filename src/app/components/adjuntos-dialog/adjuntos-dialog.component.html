<h2 mat-dialog-title>
  <mat-icon>attach_file</mat-icon>
  Archivos Adjuntos
</h2>

<mat-dialog-content>
  <mat-progress-bar *ngIf="cargando" mode="indeterminate"></mat-progress-bar>

  <div class="upload-area">
    <input 
      type="file" 
      #fileInput 
      (change)="onFileSelected($event)" 
      style="display: none"
      accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
    <button mat-raised-button color="primary" (click)="fileInput.click()" [disabled]="subiendo">
      <mat-icon>cloud_upload</mat-icon>
      Subir Archivo
    </button>
    <small>Máximo 5MB - Imágenes, PDF, Word, Excel</small>
  </div>

  <div class="subiendo" *ngIf="subiendo">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <span>Subiendo archivo...</span>
  </div>

  <div class="adjuntos-lista">
    <div class="no-adjuntos" *ngIf="adjuntos.length === 0 && !cargando">
      <mat-icon>folder_open</mat-icon>
      <p>No hay archivos adjuntos</p>
    </div>

    <div *ngFor="let adjunto of adjuntos; trackBy: trackAdjunto" class="adjunto-item">
      <!-- Si es imagen, renderiza miniatura -->
      <img *ngIf="adjunto.tipoArchivo && adjunto.tipoArchivo.startsWith('image')" [src]="'data:' + adjunto.tipoArchivo + ';base64,' + adjunto.base64" alt="Miniatura" class="miniatura" width="48" height="48" />
      <mat-icon *ngIf="!adjunto.tipoArchivo || !adjunto.tipoArchivo.startsWith('image')" class="icono-archivo">{{ getIconoArchivo(adjunto.nombreArchivo) }}</mat-icon>
      <div class="adjunto-info">
        <div class="nombre">{{ adjunto.nombreArchivo }}</div>
        <div class="detalles">
          <span class="tamano">{{ formatearTamano(adjunto.tamano) }}</span>
          <span class="fecha">{{ adjunto.fechaSubida | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>
      <div class="adjunto-actions">
          <button mat-icon-button (click)="descargarAdjunto(adjunto)" matTooltip="Descargar">
            <mat-icon>download</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="eliminarAdjunto(adjunto)" matTooltip="Eliminar">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cerrar()">Cerrar</button>
</mat-dialog-actions>
